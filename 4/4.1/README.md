# 网络层介绍
+ TCP/IP 协议簇中的网络层负责主机到主机之间的报文传递。
+ 因特网是互联网，是多个 LAN 和 WAN 的组合。

## 网络层服务
+ 分组：网络层负责在源端将负载（从上层接收到的数据）封装进网络层分组并且在目的端从网络层分组中解封负载。换言之，网络层的一个责任是从源端向目的端携带数据而不改变或使用它。
+ 路由：网络层负责将分组从源端路由到目的端路由，网络层负责寻找最佳路由。（通过某些路由协议）
+ 转发：当路由器从它连接的网络接收到一个分组时，它需要将分组转发到另一个所连接的网络上（在单播路由中）或者转发到多个自己所连接到的网络上（在多播路由中）。
+ 差错控制：一般由上层协议提供，也可通过 ICMP 辅助协议提供。
+ 流量控制：一般由上层协议提供，尽量使网络层简单；
+ 拥塞控制：一般由上层协议提供，尽量使网络层简单；
+ 服务质量：绝大多数在上层实现；
+ 安全：IPSec；

## 分组交换
+ 路由器是一个创建了输入端口和输出端口（或一组输出端口）连接的交换机，就像将输入连接到输出电流流动的开关。
+ 数据通信交换技术被分为两大类：电路交换与分组交换。网络层只使用分组交换，因为这一层的数据单位是分组。
+ 在网络层，来自上层的报文被分割成可管理的分组，每个分组从网络中发送。

### 数据报方法：无连接服务
+ 当网络层提供无连接服务时，因特网中每个正在传送的分组都是一个独立的实体；属于同一个报文的多个分组之间没有联系。这种网络中的交换机称为路由器。
+ 每个分组都是基于其头部信息进行路由的：源地址和目的地址。目的地址定义了它应该去哪里，源地址定义了它从哪里来。
+ 在数据报方法中，转发决策基于分组的目的地址。

### 虚电路方法：面向连接服务
+ 在面向连接服务（也称作虚电路方法）中，属于同一报文中的所有分组存在联系。在报文中的所有数据报被发送之前，应该建立虚连接从而定义数据报的路径。在连接建立以后，数据报可以沿着相同的路径发送。在这种类型服务中，分组不仅必须包含源和目的地址，也必须包含流标号，这是一个虚电路标识符，它定义了分组应该经过的路径。
+ 为了创建面向连接服务，使用一个三阶段过程：建立、数据交换和拆除；在虚电路方法中，转发策略基于分组的标签；
+ 建立阶段：
  + 在建立阶段，路由器为虚电路创建了一个表格项；两个辅助分组需要在发送方和接收方之间交换：请求分组与确认分组。
  + 请求分组：一个请求分组从源端发送到目的端。这个辅助分组携带源和目的地址。
  + 确认分组：一种特殊的分组，称为确认分组，它完成了交换表中的表格项。
+ 数据传输阶段：
  + 在所有路由器为特定虚电路创建好它们的转发表之后，属于同一报文的网络层分组可以被一个接一个地发送。
  + 报文中所有的分组都是按照相同的标签序列，并且分组是有序到达目的端的。
+ 拆除阶段：
  + 在拆除阶段，在所有分组发送到 B 之后，源 A 发送一个成为拆除分组的特殊分组。目的 B 以确认分组回复。所有路由器从它们的表格中删除相应的项。