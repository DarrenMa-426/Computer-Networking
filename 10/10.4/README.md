# Internet 安全

## 传输层安全
- 在传输层提供安全的协议主要有两个：安全套接层（Secure Sockets Layer，SSL）协议和传输层安全（Transport Layer Security，TLS）协议。后者实际上就是前者的 IETF 版本。
- 这些协议的目标之一就是提供服务器与客户之间的认证、数据机密性和数据完整性。

### SSL 结构
- SSL 被设计成为应用层产生的数据提供安全和压缩服务。SSL 可以接收任何应用层协议的数据，但是典型的是是 HTTP 协议。从应用层接收到的数据被 SSL 压缩（可选）、签名和加密。
- SSL 为从应用层接收到的数据提供多种服务：
  - 分段：首先，SSL 把数据划分为等于或小于 2 的 14 次方个字节的块；
  - 压缩：客户和服务器之间协商一种无损压缩方法，同时利用该方法对数据的每个分段压缩。这种服务是可选的；
  - 消息完整性：为了保护数据的完整性，SSL 使用一种密钥散列算法构建一个 MAC；
  - 保密性：为了提供保密性，原始数据和 MAC 值利用对称密钥密码进行加密；
  - 成帧：给被加密的有效载荷增加一个头部，然后将它传递给一个可靠的传输层协议；
- 密码参数生成：
  - 为了实现消息的完整性和保密性，SSL 需要 6 个密码秘密信息：4 个密钥和 2个 IV（初始化向量）。客户需要一个密钥进行消息认证（散列函数），一个密钥进行加密（对称加密）、一个 IV 在计算中作为初始块。服务器与客户端相同。SSL 要求一个方向上的密钥要不同于另一个方向上的密钥。如果在一个方向上存在一个攻击，另一个方向不会受到影响。
  - 客户端与服务器交换两个随机数；一个由客户端生成，另一个由服务端生成；
  - 客户与服务器利用一个预先定义的密钥交换算法交换一个预主密码；
  - 对预主密码应用两个散列函数（SHA-1 和 MD5）创建一个 48 字节的主密码；
  - 通过应用相同的散列函数集和增加不同的常数，主密码可用于构建可变长度的密料；
  - 从密料中提取出 6 个不同的秘密信息；
- 在 SSL 中，客户与服务器需要在它们自己之间创建一个连接。两个实体交换两个随机数，利用主密码创建密钥及其参数。这些密钥和参数用于对交换的信息进行认证和隐私保护。

### SSL 中的四个协议
- 握手协议
  - 握手协议（Handshake Protocol）利用消息来协商密码组，如果需要，它也实施客户机认证服务与服务器认证客户机。
  - 第一阶段：建立安全能力。在第一阶段，客户机和服务器通告它们的安全能力并选出两者都支持的安全方法。这个阶段建立会话 ID 并选择密码组，同时双方协商一个特定的压缩方法。最后，客户机与服务器各选择一个随机数，用于生成主密码。在阶段一之后，客户机与服务器知道了 SSL 的版本、安全算法、压缩算法和密钥生成的两个随机数。
  - 第二阶段：服务器认证和密钥交换。在第二阶段，如果需要，服务器则认证它主机。发送方可以发送它的证书、它的公钥，并从客户机请求证书。在第二阶段之后，客户机认证了服务器。如果需要，客户机能够知道服务器的公钥；
  - 第三阶段：客户机认证和密钥交换。在第三阶段被设计成认证客户机。在第三阶段之后，服务器认证了客户机，客户机和服务器两者都知道了预主密码；
  - 第四阶段：终止和结束。在第四阶段，客户和服务器发送消息，以改变密码规格并完成握手协议。
- 改变密码规格协议
  - SSL 规定，直到发送和收到改变密码规格这个特殊的消息，双方才能使用这些参数或密码。改变密码规格这个消息在握手协议中进行交换，在改变密码规格协议中进行定义。
- 警告协议
  - SSL 使用警告协议报告错误和非正常情况。
- 记录协议
  - 记录协议承载来自上层（握手协议、改变密码规格协议、警告协议或应用层）的消息。该消息被分段和有选择地压缩，并将协商好的散列算法生成的 MAC 添加到压缩消息。之后，利用协商好的加密算法对压缩的分段和 MAC 进行加密。最后，将 SSL 头部添加到加密后的消息前。发送方与接收方的处理过程与此相反。

## 网络层安全
- IP 层安全（IP Security，IPSec）是一个由 Internet 工程任务组（IETF）设计的一组协议，用于为网络层分组提供安全。
- IPSec 中有两种模式
  - 传输模式：在传输模式中不保护 IP 头部，只保护被封装在网络层中的有效载荷；
  - 隧道模式：在隧道模式中，IPSec 保护整个 IP 分组；

## 防火墙