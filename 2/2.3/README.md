# 标准客户-服务器应用
+ HTTP和万维网
+ 文件传输和电子邮件应用
+ TELNET 和 SSH 协议（远程登录）
+ DNS

## 万维网
+ 万维网（WWW/Web）是分布式的（distributed）和链接的（linked）
  + 分布式：分布式允许 Web 增长。世界上每个 Web 服务器都可以增加一个新的网页到这个宝库中并向所有因特网用户宣告，而这不会使一些服务器超载。
  + 链接：链接使得一个网页与另一个存储在世界某个地方的主机上的网页相互引用。
+ 如今 WWW 是一个分布式客户-服务器服务。使得浏览器的用户可以访问一个正在服务器上运行的服务。然而服务是分布在很多称为站点（site）的地点上。每一个站点有一个或多个文档，它们称为网页。但是，每个网页（web page）可以包含一些到其他网页的链接，那些被链接的网页可以在同一个站点也可以在其他站点。
+ 网络客户（浏览器）通常包含三部分：控制程序、客户协议和解释程序。
  + 控制程序接收来自键盘和鼠标的输入并使用客户端程序来访问文档；
  + 客户协议可以是HTTP 或 FTP；
  + 在文档被访问后，控制程序使用解释程序来在屏幕上显示文档；（HTML、Java 或 Javascript）
+ 网络资源定位符（URL）包含了四个标识符：协议、主机、端口、路径。
+ 网上文档
  + 静态文档（Static Document）：静态文档是在服务器中创建和存储的固定内容的文档。文件的内容在创建时决定，而不是使用时决定。（Hypertext Markup Language, HTML、Extensible Markup Language, XML、Extensible Style Language, XSL）;
  + 动态文档（Dynamic Document）：当浏览器请求文档时动态文档就被网页服务器创建。由于对每个请求都要创建一个全新的文档，因此动态文档的内容随着请求的不同而不同。（CGI、JSP、ASP）
  + 活动文档（Active Document）：对很多应用来说，我们需要在客户站点运行一个程序或脚本，这些称为活动文档。（Javascript）

## 超文本传输协议（HTTP）
+ HTTP 是一种用来定义客户服务器程序如何编写和如何从万维网获取网页的协议。一个 HTTP 客户发送一个请求；HTTP 服务器返回响应。服务器使用80端口号；客户使用一个临时端口号。HTTP 使用 TCP 服务。
+ 非持续连接
  + 客户开启一个 TCP 连接并发送请求；
  + 服务器发送响应并关闭连接；
  + 客户读取数据直到它遇到了文件结束标记，然后关闭连接；
+ 非持续策略给服务器带来了高额开销，因为每次连接被开启时服务器都需要 N+1 个不同的缓冲区。
+ HTTP1.1 版默认指定了持续连接。在持续连接中服务器在发送一个相应后，为响应更多的请求而将连接置为打开状态。服务器可以在客户的请求下或者在超时情况下将连接关闭。发送方通常在每次响应中发送数据长度。
+ 请求报文
  + 请求的第一行被称为请求行，这一行有三部分由空格隔开并且被两个字符（回车和换行）终止。这些字段称为方法、URL 和版本。
+ 请求方法
  + GET：向服务器请求文档；
  + HEAD：请求关于文档的信息，而不是文档本身；
  + PUT：从客户端向服务器发送文档；
  + POST：从客户端向服务器发送一些信息；
  + TRACE：回送输入的请求；
  + DELETE：删除网页；
  + CONNECT：预留；
  + OPTIONS：询问有关可用的选项；
+ 请求头部
  + User-agent：表示客户端程序；
  + Accept：给出客户端能够接受的媒体格式；
  + Accept-charset：给出客户端可以处理的字符集；
  + Accept-encoding：给出客户端可以处理的编码方案；
  + Accept-language：给出客户端可以接受的语言；
  + Authorization：给出客户端有哪些许可；
  + Host：给出主机及客户端的端口号；
  + Date：给出当前日期；
  + Upgrade：确定首选的通信协议；
  + Cookie：返回 cookie 给服务器
  + If-Modified-Since：如果文档在指定的日期之后被更新，则发送文档；
+ 响应报文
  + 响应报文包含状态行、头部行并且有时包含主体。
  + 状态码字段
    + 100~199：代表一个报告；
    + 200~299：表示这是一个成功的请求；
    + 300~399：表示把客户端重定向到另一个 URL；
    + 400~499：表示在客户端发生错误；
    + 500~599：表示在服务端发生错误；
+ 响应头部行
  + Date：给出当前日期；
  + Upgrade：确定首选的通信协议；
  + Server：给出服务器信息；
  + Set-Cookie：服务器要求客户存储 cookie；
  + Content-Encoding：指定编码方案；
  + Content-Language：指定语言；
  + Content-Length：给出文档长度；
  + Content-Type：指定媒体类型；
  + Location：指明新建或移动后文档的位置；
  + Accept-Ranges：服务器将会接收的被请求的字节范围；
  + Last-modified：给出上次改变的日期和时间；

## Cookie
+ 创建和存储 Cookie
  + 当服务器从客户端接收到请求后，它将客户端的信息存储在文件或字符串中。这些信息可能包括客户端的域名、cookie 内容（服务器收集到的关于客户端的信息，如主机名、注册号等）、时间戳，以及与实现相关的其他信息；
  + 服务器在响应中包含了它发送给客户端的 cookie；
  + 当客户端接收到响应后，浏览器在 cookie 目录中存储 cookie，并根据服务器域名进行分类；
+ 使用 cookie
  + 当客户向服务器发送请求时，浏览器在 cookie 目录中查询是否有从那个服务器发送过来的 cookie，如果有，则在请求中包含这个 cookie。

## 万维网高速缓存：代理服务器
HTTP 支持代理服务器（proxy server）。代理服务器是一台计算机，能够保存最近请求的响应的副本。HTTP 客户端向代理服务器发送请求。代理服务器检查本地高速缓存。如果高速缓存中不存在响应报文，代理服务器就向响应的服务器发送请求。返回的响应会发送到代理服务器中，并且进行存储，以用于其他客户端将来的请求。（如七牛 cdn 加速）

## HTTP 安全
HTTP 本质上并不提供安全。然而，HTTP 可以在安全套接层（SSL）上运行。在这种情况下，HTTP 称为 HTTPS。HTTPS 提供保密性、客户和服务器鉴别，以及数据完整性。

## FTP
+ 文件传输协议（File Transfer Protocol, FTP）是 TCP/IP 提供的标准机制，用于将文件从一个主机复制到另一个主机。
+ FTP 基本模型中。客户有三个组件：用户接口、客户控制进程、数据传输进程。服务器有两个组件：服务器控制进程和服务器数据传输进程。控制连接是在控制进程之间进行的，而数据连接是在数据传输进程之间进行的。
+ 在整个交互的 FTP 会话期间，控制连接始终处理连接状态。数据连接则在每次传输文件时开启然后关闭。FTP 使用两种熟知接口，端口 21 用于控制连接，端口 20 用于数据连接。
+ 控制连接
  + 对于控制通信，FTP 使用与 TELNET 相同的方法。它与 TELNET 一样使用 NVT ASCII 字符集。通信是通过命令和响应来完成的。
  + 常见的 FTP 命令
    | 命 令 | 参 数        | 说 明                                           |
    | ----- | :----------: | ----------------------------------------------: |
    | ABOR  |              | 放弃之前的命令                                  |
    | CDUP  |              | 改变到上级父目录                                |
    | CWD   | 目录名       | 改变到另一个目录                                |
    | DELE  | 文件名       | 删除文件                                        |
    | LIST  | 目录名       | 列出子目录或文件                                |
    | MKD   | 目录名       | 创建新目录                                      |
    | PASS  | 用户密码     | 密码                                            |
    | PASV  |              | 服务器选择一个端口                              |
    | PORT  | 端口标识符   | 客户选择一个端口                                |
    | PWD   |              | 显示当前目录名                                  |
    | QUIT  |              | 退出登录                                        |
    | RETR  | 文件名       | 获取文件；文件从服务器发送到客户                |
    | RMD   | 目录名       | 删除目录                                        |
    | RNFR  | 文件名       | 表示一个将被重命名的文件                        |
    | RNTO  | 文件名（新） | 重命名文件                                      |
    | STOR  | 文件名       | 存储文件；文件从客户发送到服务器                |
    | STRU  | F、R 或 P    | 定义数据组织（F：文件， R：记录，或者 P：页面） |
    | TYPE  | A、E、I      | 定义文件类型（A：ASCII，E：EBCDID，I：图像      |
    | USER  | 用户 ID      | 用户信息                                        |
    | MODE  | S、B、C      | 定义传输方式（S：流，B：块，C：压缩）           |
  + 常见的响应编码
    + 125：数据连接打开；
    + 150：文件状态良好；
    + 200：命令成功；
    + 220：服务就绪；
    + 221：服务关闭；
    + 225：数据连接打开；
    + 226：关闭数据连接；
    + 230：用户登录成功；
    + 250：请求文件动作成功；
    + 331：用户名成功；需要密码；
    + 425：无法打开数据连接；
    + 450：文件动作未被采取；文件不可用；
    + 452：动作被放弃；磁盘空间不足；
    + 500：语法错；无法识别的命令；
    + 501：参数或变量语法错；
    + 530：用户未登录；
+ 数据连接
  + 数据连接的步骤
    + 客户使用临时端口发起一个被动打开。这必须由客户完成，因为正是客户发出命令要求传输文件的；
    + 客户使用 PORT 命令发送这个端口号到服务器；
    + 服务器接收到端口号，使用熟知端口 20 发出主动打开并且接收临时端口号；
  + 数据连接的目的和实现与控制连接是不同的。在通过数据连接发送文件之前，我们必须通过控制连接定义传输文件的类型、数据结构以及传输方式。
+ FTP 安全：尽管 FTP 要求密码，但是密码还是用明文（未加密）发送，这意味着它可能被截获并被使用者攻击。数据传输连接也用明文传输数据，这是不安全的。为了安全起见，可以将安全套接层加入到 FTP 应用层和 TCP 层之间。这种情况下，FTP 称为 SSL-FTP。

## 电子邮件
+ 一个子邮件系统需要两个 UA（User Agent），一对 MTA（Mail Transfer Agent）（客户与服务器）以及一对 MAA（Mail Access Agent）（客户与服务器）
+ 传输一个邮件共有三个阶段：连接建立、邮件传输和连接终止。
  + 连接建立：在客户创建了到端口 25 的 TCP 连接后，SMTP（Simple Mail Transfer Protocol） 服务器开始连接阶段。
  + 邮件传输：在 SMTP 客户和服务器的连接建立后，单个报文可以在一个发信人和多个收信人之间交换。
  + 连接终止：在报文成功传送后，客户终止连接。
+ 报文访问代理：邮件传递的第一阶段和第二阶段使用 SMTP。但是，因为 SMTP 是一个推（push）协议，第三阶段不使用 SMTP。第三阶段可以使用 POP、IMAP、HTTP 协议。

## TELNET
TELNET（TErminaL NETwork）是远程登录协议之一。
+ 本地登录与远程登录
  + 本地登录：当一个用户登录到本地系统，这称为本地登录（local login）。用户在终端上键入时或在工作站运行终端仿真程序时，她的击键就被终端驱动程序所接受。终端驱动程序将字符传递给操作系统，操作系统解释字符的组合，并调用所需的应用程序或实用工具。
  + 远程登录：用户将击键发送给终端驱动程序，同时本地操作系统接收这些字符，但不解释它们。这些字符被发送到 TELNET 客户机，它将这些字段转换为网络虚拟终端（Network Virtual Terminal，NVT）字符的通用字符集，然后将其传送给本地 TCP/IP 协议堆栈。采用网络虚拟终端（NVT）形式的命令或文本通过因特网传送到远程机器的 TCP/IP 堆栈，在那里字符传递给操作系统，然后传送给 TELNET 服务器，TELNET 服务器将这些字符转换为远程计算机可以理解的字符，再通过终端驱动程序（pseudo terminal driver）的软件块伪装成终端命令，最后传递给操作系统，操作系统解释字符的组合，并调用所需的应用程序或实用工具。

## 安全 Shell
+ SSH 应用层协议（SSH-TRANS）：由于 TCP 不是安全传输层协议，SSH 首先使用在 TCP 顶部创建安全链路的协议。这个新层是一个独立协议，称为 SSH-TRANS。当执行这个协议的程序被调用时，客户和服务器首先使用 TCP 协议建立一个不安全的连接。然后，它们交换几个安全参数在 TCP 顶部建立安全信道。
+ SSH 认证协议（SSH-AUTH）：在客户与服务器之间的安全信道建立以及客户端认证服务器之后，SSH 可以调用另一个流程，它为服务器对客户进行认证。
+ SSH 连接协议（SSH-CONN）
+ SSH 是一个提供客户和服务器之间安全连接的通用协议，可以用于远程登录，也可以用于文件传输（SFTP）。
+ SSH 协议提供的端口转发（port forward）机制可以创建一个安全隧道，属于其他协议的报文可以穿过这个隧道。

## 域名系统
域名系统（Domain Name System）是一种能够将名字映射到地址的目录系统。
+ 主机名映射到 IP 地址的步骤
  + 用户将主机名传递给文件传输客户端；
  + 文件传输客户端将主机名传递到 DNS 客户端；
  + 在启动后，每一台电脑都知道 DNS 服务器的地址。DNS 客户端使用已知 DNS 服务器 IP 地址向 DNS 服务器发送附有查询的报文，查询报文使用已知的 DNS 服务器 IP 地址给出文件服务器名；
  + DNS 服务器进行响应，发回客户想要获得的文件传输服务器的 IP 地址；
  + DNS 客户端将 IP 地址传递到文件传输服务器；
  + 现在，文件传输客户端使用接收到的 IP 地址来访问文件传输服务器；
+ 域名空间
  + 为了获得层次名字空间，设计了域名空间（domain name space）。在这种设计方式中，所有的名字由根在顶部的倒置树结构定义。
  + 标签：树上的每一个节点有一个标签。DNS 要求每一个节点的子节点（从同一节点分支出来的节点）都有不同的标签，这样就确保域名的唯一性。
  + 域名：树上的每一个节点都有一个域名。一个完整的域名（domain name）是用点（.）分割的标签序列。
  + 域（Domain）是域命名空间的子树。域的名称是子树顶端节点的名称。
+ DNS 定义了两种类型的服务器：主服务器和辅助服务器；
  + 主服务器（primary server）是指存储了授权区域有关文件的服务器。它负责创建、维护和更新区域文件，并将区域文件存储在本地磁盘中。
  + 辅助服务器（secondary sever）负责从另一个服务器（主服务器或辅助服务器）传输一个区域的全部信息，并将文件存储在它的本地磁盘中。
  + 主服务器能从磁盘文件中装载所有信息，辅助服务器从主服务器中装载信息。
+ 通用域（generic domain）按照已经注册主机的一般行为对主机进行定义。
  + aero：航空航天公司
  + biz：商业或公司
  + com：商业机构
  + coop：协作商业组织
  + edu：教育机构
  + gov：政府机构
  + info：信息服务提供商
  + int：国际机构
  + mil：军事机构
  + museum：博物馆
  + name：私人名字（个人的）
  + net：网络支持中心
  + org：非盈利机构
  + pro：专业组织
+ 国家域（country domain）部分使用双字母的国家缩写（例如，us 代表美国）。
+ 将名字映射为地址或将地址映射为名字的过程，成为名字-地址解析（name-address resolution）。
  + 递归解析
    + 源主机上的应用程序调用 DNS 解析程序（客户端）（如 hosts 文件）来找到目的服务器的 IP 地址。
    + （解析程序不知道这个地址）将请求发送到本地 DNS 服务器（例如局域网 DNS）
    + （假设本地 DNS 不知道这个地址）本地 DNS 服务器发送一个请求到 DNS 根服务器，本地 DNS 服务器应该知道根服务器的 DNS 地址。
    + 根服务器通常不保存名字到 IP 地址的映射，但是根服务器至少至少每个顶级域中的一台主机（例如.com、.cn）。根服务器将查询发送到这台顶级域服务器。
    + （假设顶级域服务器不知道特定目的名字-地址映射）顶级域服务器查询到该特定名字域名所在的 DNS 服务器 IP 地址，查询被发送到这台服务器。
    + 特定名字 DNS 服务器将 IP 地址返回到顶层 DNS 服务器，然后返回到根服务器，然后返回到本地 DNS 服务器，它可能缓存这个地址以待将来的查询，并且最终返回给源主机。
  + 迭代解析
    + 在迭代解析中，每个不知道映射的服务器将下一台服务器的 IP 地址发回到请求查询的主机上。
    + 通常迭代解析发生在两台本地服务器之间；原始解析程序从本地服务器得到最终答案。
  + 高速缓存
    + 每当服务器接收到查询一个不属于自己域的名字时，它需要搜索自己的数据库以查找一台服务器的 IP 地址。（效率较慢）
    + DNS 服务器使用一种称为高速缓存（cache）的机制处理这一问题。当一个服务器向另一个服务器请求映射并得到回应时，在将该回应发送给客户端之前，先将这一信息存储在高速缓存中。如果同一客户端或者另一个客户端请求同一映射时，它会检查其告诉缓存并解决这一问题。
    + 高速缓存会定期检查，并清除掉 TTL 已经过期的那些映射。
+ DNS 报文
  + DNS使用查询报文（query）和响应报文（response）
+ 封装
  + DNS 可以只用 UDP 和 TCP 协议。（熟知端口：53）
  + 当响应报文的长度小于 512 字节时，就使用 UDP。反之，则必须使用 TCP 连接。
+ 注册机构
  + 新的域名通过注册机构（registrar）来完成，一个熟知的商业实体是 ICANN（因特网名称和编号分配组织）。
  + 为了能够注册，组织机构需要给出域名服务器的主机名和 IP 地址。
  + 动态域名系统（Dynamic Domain Name System，DDNS）中，当主机名和 IP 地址之间的绑定被确定时，这些信息通常是由 DHCP 发送给主 DNS 服务器。主服务器更新这一区域，同时通知到辅助服务器。
+ DNS 安全
  + 攻击者可能读取 DNS 服务器的响应，从而发现用户最常访问的站点的名称。
  + 攻击者可能截获 DNS 服务器的响应并加以改变，或创建一个全新的伪造响应来将用户导向攻击者想要用户访问的站点或域。
  + 攻击者可能泛洪攻击淹没 DNS 服务器，最终使之瘫痪。