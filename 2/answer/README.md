# Practice

## 练习题
- Q2-1 假设我们加入一个新的协议到应用层上。我们需要对其他层做什么改动？
  - 答：不需要做任何改动。因为应用层是最顶层协议，没有其他层依赖于应用层，所以新增一个新的协议到应用层，只需要使协议能够被传输层的协议读取即可。

- Q2-2 请解释在客户-服务器模式中哪个实体提供服务，哪个实体接收服务？
  - 答：服务器负责提供服务，客户（代理）负责接收服务。

- Q2-3 在客户-服务器模式中，请解释为什么服务器应该一直运行而客户可以在需要时运行。
  - 答：因为客户只需要在（某个）客户使用时，打开与服务器的连接，向服务器请求服务；而服务器需要随时接收来自多个客户的请求，所以必须一直运行。

- Q2-4 可否在一个只安装了 TCP 作为传输层协议的计算机上编写一个使用 UDP 服务的程序？请解释。
  - 答：不可以；因为 TCP/IP 协议簇是自顶向下，当程序从应用层到达传输层时，会因为找不到 UDP 协议的支持而导致传输失败。顶层协议依赖于底层协议。

- Q2-5 在周末，Alice 经常要从她家的笔记本电脑访问存储在办公室桌面的文件。上个星期，她在办公室桌面上安装了 FTP 服务器进程并在家里的笔记本上安装了 FTP 客户进程。当她周末无法访问文件时，感到很失望。哪里错了吗？
  - 答：因为 Alice 办公室和家里的网络并不是同一个局域网，无法直接通过局域网访问另一个局域网。如果需要访问的话，应该使用路由器和交换机将两个局域网连接在一起，或者将办公室的公网进行公开（任何人可以通过公网 ip 访问）。

- Q2-6 安装在个人计算机上的绝大多数操作系统有很多客户进程，但通常没有服务进程。请解释原因。
  - 答：个人计算机一般来说不需要提供服务，只需要接收服务，所以不需要服务进程。

- Q2-7 要设计一个使用客户-服务器模式的新应用。如果在客户和服务器之间只需要交换小报文而不用担心报文丢失或出错，你推荐使用什么传输层协议？
  - 答：UDP 协议。因为 UDP 协议没有额外的机制，只负责传输，而不保证报文的完整性和正确性，从而提升传输效率。

- Q2-8 以下哪项可以是数据源？
 + a．键盘 b．显示器 c．套接字
 + 答：a

- Q2-9 源套接字地址是 IP 地址和端口号的组合。请解释每部分定义的内容。
  - 答：IP 地址就是目标服务器唯一 IP 地址；端口就是目标服务器所运行的应用的进程所在的端口号。

- Q2-10 请解释客户进程如何得到要插入远程套接字地址中的 IP 地址和端口号。
  - 答：
    - 有时，开启客户进程的用户知道运行着服务器进程的计算机的端口号和 IP 地址；
    - 有时，用户只知道一个域名，通过应用层的 DNS 协议后，域名将会被转换为 IP 地址。而应用层协议一般都有熟知的端口号，例如 HTTP 的熟知端口号为 80，在没有提供显式端口号的情况下，会使用熟知端口号作为目标服务器的端口号。

- Q2-11 如果一个 HTTP 请求需要在服务器端运行一个程序并且将结果下载到客户服务器，这个程序是以下的
  - a．静态文档 b．动态文档 c．活动文档
  - 答：b

- Q2-12 假设我们设计了一个新的客户-服务器应用程序，它需要持续连接。我们能使用 UDP 作为传输层协议吗？
  - 答：不能。因为 UDP 没有连接状态，属于无连接协议；我们应该使用 TCP 作为传输层协议，它具有持续连接的特性。

- Q2-13 Alice 有一个视频片段，Bob 想得到它；Bob 有另一个视频片段，Alice 想得到它。Bob 创建了一个网页并在 HTTP 服务器上运行。Alice 如何得到 Bob 的视频片段？Bob 能够得到 Alice 的吗？
  - 答：Alice 通过发送一个 GET 请求，可以在响应中获得 Bob 的视频片段；Bob 如果想要获得 Alice 的视频片段，只能让 Alice 通过一个 PUT HTTP 请求将视频片段传输到 Bob 的服务端。

- Q2-14 当 HTTP 服务器接收到来自 HTTP 客户的请求报文时，服务器如何知道所有头部以及跟随其后的报文主体何时到达？
  - 答：报文包含了结束标记，如果读取到结束标记，则表示所有头部及报文主体发送完毕；

- Q2-15 在非持续 HTTP 连接中，HTTP 如何通知 TCP 协议报文已到达结尾？
  - 答：在响应报文结尾添加文件结束标记，在客户端检测到响应结束时，客户端通知 TCP 协议报文关闭连接。

- Q2-16 在日常生活通信中，你能找到与 FTP 的控制和数据连接相似的两个分离的连接吗？
  - 答：

- Q2-17 FTP 使用两个不同的熟知端口号用于控制和数据传输。这是否意味着为了交换控制信息和数据而创建了两个分离的 TCP 连接？
  - 答：是的，交换控制信息和传输数据创建了两个分离的 TCP 连接。

- Q2-18 FTP 使用 TCP 服务交换控制信息并进行数据传输。FTP 能够为这两种连接使用 UDP 服务吗？请解释。
  - 答：不能，首先 UDP 是无连接协议，没有稳定的连接状态；并且 UDP 存在传输字节大小限制，而且 UDP 无法保证传输的正确性和完整性，不适合用于数据传输。

- Q2-19 在 FTP 中，哪个实体（客户或服务器）开启（主动开启）控制连接？哪个实体开启（主动开启）数据传输连接？
  - 答：客户主动开启控制连接；服务器主动开启数据传输连接；

- Q2-20 如果控制连接在 FTP 会话结束前被中断，你认为会发生什么？它会影响数据连接吗？
  - 答：不会影响当前正在进行的数据连接，因为数据连接和控制连接是两个分离的 TCP 连接，会话结束前并没有发送终止传输指令的话，并不会影响数据连接。

- Q2-21 在 FTP 中，如果客户需要从服务器站点获取一个文件并且存储一个文件到服务器站点上，这需要多少个控制连接和数据传输连接？
  - 答：只需要一个控制连接和一个数据传输连接即可；因为传输是支持双向的。

- Q2-22 在 FTP 中，服务器可以从客户端获取文件吗？

- Q2-23 在 FTP 中，服务器能够从客户端得到文件列表或目录吗？

- Q2-24 FTP 可以在两个使用不同操作系统的主机之间传输文件。这是什么原因？

- Q2-25 在控制连接期间，FTP 有用于交换命令和响应的报文格式吗？

- Q2-26 在文件传输期间，FTP 有用于交换文件或目录/文件列表的报文格式吗？

- Q2-27 在 FTP 中能够只有控制连接而没有数据连接吗？请解释。

- Q2-28 在 FTP 中能够只有数据连接而没有控制连接吗？请解释。

- Q2-29 假设我们需要使用 FTP 下载一个音频。我们可以在命令中指定什么文件类型？

- Q2-30 HTTP 和 FTP 都可以从服务器获取文件。当我们下载文件时使用什么协议？

- Q2-31 HELO 和 MAIL FROM 命令在 SMTP 中都是必要的吗？为什么？

- Q2-32 在图 2-20 的文字中，信封中的 MAIL FROM 与头部的 FROM 有什么区别？

- Q2-33 Alice 在长途旅行中，没有查看她的电子邮件。之后她发现丢失了一些朋友们声称已经发给她的电子邮件或附件。这其中的问题可能是什么？

- Q2-34 假设一个 TELNET 客户使用 ASCII 表示字符，但是 TELNET 服务器使用 EBCDIC 代表字符。当两者字符表示不同，客户如何登录到服务器上？

- Q2-35 TELNET 应用程序中没有像 FTP 或 HTTP 中允许用户传输文件或访问页面的命令。这种应用程序在哪个方面有用？

- Q2-36 一台主机能够使用一个 TELNET 客户获得 FTP 或 HTTP 等其他客户-服务器应用所提供的服务吗？

- Q2-37 在 DNS 中，以下哪一项是 FQDN，哪一项是 PQDN？
  + a．xxx b．xxx.yyy.net c．zzz.yyy.xxx.edu.

- Q2-38 在基于 DHT 的网络中，假设 m = 4。如果一个结点标识符的散列值为 18，这个结点在 DHT 空间中的位置在哪里？

- Q2-39 在基于 DHT 的网络中，假设结点 4 有一个文件的关键字为 18。最接近关键字 18 的结点是 20。这个文件存储在哪里？
  + a．按照直接方法 b．按照间接方法
- Q2-40 在 Chord 网络中，我们有结点 N5 和关键字 k5。N5 是 k5 的前向结点还是后向结点？

- Q2-41 在 Kademlia 网络中，标识符空间的大小为 1024。二叉树的高度（树根到叶结点的距离）是多少？每个结点的子树数量是多少？每个路由表有多少行？

- Q2-42 在 Kademlia 中，假设 m = 4 并且活动结点是 N4、N7 和 N12。k3 存储在系统的哪个位置？
## 思考题
- P2-1 假设一个服务器的域名是 www.common.com。
  + a．给出一个想要获取文件/usr/users/doc 的 HTTP 请求。客户接收 MIME 1 版、GIF 或 JPEG 图片，但是文档的存在时间不应该超过 4 天。
  + b．给出与 a 成功请求对应的 HTTP 响应。
  
- P2-2 在 HTTP 中，画一幅图来给出 cookie 的应用，cookie 的应用场景是服务器只允许注册用户访问服务器。

- P2-3 在 HTTP 中，画一幅图来给出网络门户中 cookie 的应用，请使用两个站点来表示。

- P2-4 在 HTTP 中，画一幅图来给出 cookie 的应用，cookie 的应用场景是服务器使用 cookie 来做广告，请只用三个站点。

- P2-5 请画图给出代理服务器的使用，代理服务器是客户网络的一部分：
  + a．给出当响应存储在代理服务器时，客户、代理服务器以及目标服务器之间的事务。
  + b．给出当响应不存储在代理服务器时，客户、代理服务器以及目标服务器之间的事务。
  
- P2-6 在第 1 章，我们提到 TCP/IP 协议簇与 OSI 模型不同，它没有表示层。但是如果需要，应用层协议可以包含某些表示层定义的特征。HTTP 有表示层特征吗？

- P2-7 HTTP 1.1 版将持续连接定义为默认连接。使用 RFC2616 找出客户或服务器如何将这个默认设置改为非持续连接？

- P2-8 在第 1 章，我们提到 TCP/IP 协议簇与 OSI 模型不同，它没有会话层。但是如果需要，应用层协议可以包含某些会话层定义的特征。HTTP 有会话层特征吗？

- P2-9 在 SMTP 中，一个发送者发送未格式化文本，请给出 MIME 头部。

- P2-10 在 SMTP 中：
  + a．一个非 ASCII 码 1000 字节的报文使用 base64 编码。编码报文中有多少字节？有多少冗余字节？冗余字节与整个报文的比是多少？
  + b．一个非 ASCII 码 1000 字节的报文使用引用可打印编码。报文包含 90%ASCII 字符和 10%非 ASCII字符。编码报文中有多少字节？有多少冗余字节？冗余字节与整个报文的比是多少？
  + c．比较前两个情况的结果。如果报文是 ASCII 和非 ASCII 字符报文的组合，效率提高多少？

- P2-11 请用 base64 编码如下报文：
  + 01010111 00001111 11110000

- P2-12 请用引用可打印编码如下报文：
  + 01001111 10101111 01110001

- P2-13 根据 RFC1939，POP3 会话是以下四种状态之一：关闭、认证、事务或更新。画图给出这四种状态以及 POP3 如何在这些状态之间移动。

- P2-14 POP3 协议有一些基本命令（每个客户-服务器需要实现）。使用 RFC1939 中的信息，找出以下基本命令的含义和用法：
  + a．STAT b．LIST c．DELE 4

- P2-15 POP3 协议有一些可选命令（每个客户-服务器需要实现）。使用 RFC1939 中的信息，找出以下可选命令的含义和用法：
  + a．UIDL b．TOP 1 15 c．USER d．PASS

- P2-16 使用 RFC1939，假设 POP3 客户处于下载保持状态。如果服务器只从服务器下载两个 192 字节和 300字节报文，请给出客户和服务器之间的事务。

- P2-17 使用 RFC1939，假设 POP3 客户处于下载保持状态。如果服务器只从服务器下载两个 230 字节和 400字节报文，请给出客户和服务器之间的事务。

- P2-18 在第 1 章，我们提到 TCP/IP 协议簇与 OSI 模型不同，它没有表示层。但是如果需要，应用层协议可以包含某些表示层定义的特征。SMTP 有表示层特征吗？

- P2-19 在第 1 章，我们提到 TCP/IP 协议簇与 OSI 模型不同，它没有会话层。但是如果需要，应用层协议可以包含某些会话层定义的特征。SMTP 或 POP3 有会话层特征吗？

- P2-20 在 FTP 中，假设用户名为 John 的客户需要在服务器的目录/top/videos/general 上存储一个名为 video2的视频片段。如果选择临时端口号 56002，给出服务器和客户之间的交换的命令和响应。

- P2-21 在 FTP 中，一个用户（Jane）想要使用临时端口 61017 从/usr/users/report 目录下获取一个名为 huge的 EBCDIC 文件。文件很大，以至于用户想要在传输前压缩它。给出所有命令和响应。

- P2-22 在 FTP 中，一个用户（Jan）想要在目录/usr/usrs/letters 下创建一个名为 Jan 的新目录。给出所有命令和响应。

- P2-23 在 FTP 中，一个用户（Maria）想要将一个名为 file1 的文件从/usr/users/report 目录移动至/usr/top/letters目录下。注意，这里有文件被重命名的情况。我们首先需要给出旧文件名然后定义新名称。给出所有命令和响应。

- P2-24 在第 1 章，我们提到 TCP/IP 协议簇与 OSI 模型不同，它没有表示层。但是如果需要，应用层协议可以包含某些表示层定义的特征。FTP 有表示层特征吗？

- P2-25 在第 1 章，我们提到 TCP/IP 协议簇与 OSI 模型不同，它没有会话层。但是如果需要，应用层协议可以包含某些会话层定义的特征。FTP 有会话层特征吗？

- P2-26 在 Chord 中，假设标识符空间大小为 16。活动结点是 N3、N6、N8 以及 N12。给出 N6 的指针表（只给出目标关键字和后向结点列）。

- P2-27 在 Chord 中，假设 N12 的后向结点是 N17。N12 是以下哪个关键字的前向结点。
  + a．k12 b．k15 c．k17 d．k22

- P2-28 在使用 DHT 的 Chord 网络中，m = 4，请画出标识符空间，其中放置 4 个对等结点，它们的 ID 是 N3、N8、N11 以及 N13，以及三个关键字 k5、k9 以及 k14。请判断哪个结点负责哪个关键字。为每个结点创建一个指针表。

- P2-29 在 Chord 网络中，m = 4，结点 N2 指针表的值如下：N4、N7、N10 以及 N12。对于以下每个关键字，首先查找 N2 是否是关键的前向结点。如果不是，应该联系哪个结点（最接近前向结点）来帮助 N2找到前向结点。
  + a．k1 b．k6 c．k9 d．k13

- P2-30 重复文中的例 2.16，但是假设结点 N12 需要找到负责关键字 k7 的结点。提示：请记住在模 32 运算中需要进行区间检测。

- P2-31 重复文中的例 2.16，但是假设结点 N5 需要找到负责关键字 k16 的结点。提示：请记住在模 32 运算中需要进行区间检测。

- P2-32 在 Pastry 中，假设地址空间是 16 并且 b = 2。地址空间中有多少位？列出一些标识符。

- P2-33 在 Pastry 中 m = 32 并且 b = 4，路由表以及叶子结点集的大小是多少？

- P2-34 Pastry 的地址空间是 16 并且 b = 2，给出路由表的大纲。给出结点 N21 路由表中每个单元格的可能表项。

- P2-35 在使用 DHT 的 Pastry 网络中，m = 4 且 b = 2，请画出游 4 个结点 3 个关键字的标识符空间，4 个结点是 N02、N11、N20 以及 N23，3 个关键字是 k00、k12 以及 k24。请判断哪个结点负责哪个关键字。也请给出每个结点的叶子结点集和路由表。尽管它不是真实的，但是假设每两个结点间的接近度是基于数值接近程度度量的。

- P2-36 在之前的问题中，请回答如下问题：
  + a．给出结点 N02 如何回应一个寻找负责 k24 结点的请求。
  + b．给出结点 N20 如何回应一个寻找负责 k12 结点的请求。

- P2-37 使用文中图 2-55 的二叉树，给出结点 N11 的子树。

- P2-38 使用文中图 2-56 中的路由表，如果结点 N0 接收到一个查询报文，它寻找负责 k12 的结点，请解释并给出路由。

- P2-39 在 Kademlia 网络中 m = 4，我们有 5 个活动结点：N2、N3、N7、N10 以及 N12。找出每个活动结点的路由表（只有一列）。

- P2-40 如文中图 2-60 所示，服务器如何知道一个客户已经请求了服务？

- P2-41 如文中图 2-62 所示，服务器端如何为数据传输创建一个套接字？

- P2-42 假设我们想要使表 2-25 中的 TCP 客户程序更具通用性，从而能够发送字符串并处理从服务器接收到的响应，如何做到这一点？
  
## 2.8 模拟实验
Applets
我们构建了一些 Java 小程序用于展示本章讨论的一些主要概念。强烈推荐学生激活本书网站中的这些小程序，仔细观察这些实际的协议。

### 实验作业
- 在第 1 章，我们下载并安装了 Wireshark，学习它的基本特性。在本章，我们使用 Wireshark 来捕获并研究一些应用层协议。这里使用 Wireshark 来模拟六种协议：HTTP、FTP、TELNET、SMTP、POP3 以及 DNS。

- Lab2-1 在第 1 个实验中，我们使用 HTTP 获取网页。我们使用 Wireshark 来捕获分组进行分析。我们学习最普通的 HTTP 报文。我们也捕获响应报文并分析它们。在实验期间，我们也研究分析一些 HTTP 头部。

- Lab2-2 在第 2 个实验中，我们使用 FTP 传输一些文件。我们使用 Wireshark 捕获分组。我们展示出 FTP 使用两个分离的连接：一个控制连接和一个数据传输连接。每次文件传输活动中数据连接都会被打开然后关闭。我们也展示出 FTP 是一个不安全的文件传输协议，因为每项事务都是用明文完成的。

- Lab2-3 在第 3 个实验中，我们使用 Wireshark 捕获 TELNET 协议交换的分组。如 FTP 中一样，我们能够在被捕获的分组里观察到会话中的命令和响应。正如 FTP、TELNET 易受攻击，因为它用明文发送包括口令在内的所有数据。

- Lab2-4 在第 4 个实验中，我们研究运行中的 SMTP 协议。我们发送一个电子邮件，使用 Wireshark 研究客户和服务器之间交换的 SMTP 分组的内容和格式。我们检验文中讨论的 SMTP 会话中的三个阶段。

- Lab2-5 在第 5 个实验中，我们研究 POP3 协议的状态和行为。我们获取存储在 POP3 服务器邮箱中的邮件，通过分析那些经过 Wireshark 的报文来观察并分析 POP3 的状态以及交换报文的类型和内容。

- Lab2-6 在第 6 个实验中，我们分析 DNS 协议的行为。除了 Wireshark，许多网络实用工具可用于查找 DNS 服务器中存储的信息。在这个实验中，我们使用 dig 命令（被 nslookup 所代替）。我们也使用 ipconfig 来管理主机中缓存的 DNS 记录。当我们使用这些工具时，我们用 Wireshark 来捕获这些工具发送的分组。

## 2.9 编程作业
利用你选择的编程语言，编写源代码，编译并测试如下程序：
- Prg2-1 编写程序，使表 2-22 中的 UDP 服务器程序更通用：接收请求、处理请求并发回响应。

- Prg2-2 编写程序，使表 2-23 中的 UDP 客户程序更通用：能够发送客户程序创建的任何请求。

- Prg2-3 编写程序，使表 2-24 中的 TCP 服务器程序更通用：接收请求、处理请求并发回响应。