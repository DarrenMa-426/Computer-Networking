# 介绍
应用层为用户提供服务。通信是由逻辑连接提供的，这意味着两个应用层假设存在一个假想的直接连接。

## 提供服务
+ TCP/IP 协议簇的每一层原先由一个或多个协议组成，但是可以加入新的协议，因特网管理机构可以删除或替换某些协议。然而如果将一个协议增加到一层中，那么这个协议应当被设计成使用底层协议提供的服务。如果从一层中去除一个协议，那么应该注意去改写它的上一层协议，高层协议可能使用了它提供的服务。
+ 由于应用层是协议簇的最高层，它与其他层有些不同。这层中的协议不为其他任何其他协议提供服务，它们只接收来自传输层协议的服务。这意味着，可以从这层中轻易地去除协议。只要新的协议可以使用传输层协议提供的服务，那么就可以把它加入到这一层。

## 应用层模式
+ 客户-服务器模式
  + 在这种模式中，服务提供者是一个被称为服务进程的应用程序，它不断地运行着，等待另一个称为客户进程的的应用程序通过因特网建立连接并提供服务。服务进程必须一直运行，当需要接受服务时客户进程就被打开。
  + 很多传统服务仍然在使用这种模式，包括万维网（World Wide Web）以及它的传播媒介：超文本传输协议（HyperText Transfer Protocol, HTTP），文件传输协议（File Transfer Protocol， FTP），安全人机界面（Secure Shell， SSH）、电子邮件等。
+ 新模式：对等
  + 对等模式（P2P模式）不需要一个不断运行且等待客户进程连接的服务器进程。责任在对等节点（peer）之间分担。连接到因特网的计算机可以在这一次提供服务却在下一次接受服务。一台计算机甚至可以同时接受和提供服务。（例如 网络电话）
+ 混合模式

## 客户-服务器模式
+ 客户是一个运行着的程序，它通过发送请求初始化通信；另一个应用程序是服务器，它等待来自客户的请求。服务器处理来自客户的请求，准备结果并将其发送给客户。
+ 如果我们需要一个进程与另一个进程通信，那么我们就需要一个新的指令集告知 TCP/IP 协议簇的低四层打开连接，发送数据，从另一个端接收数据，以及关闭连接。这样的指令集通常称为应用程序接口（Application Programing Interface，API）。（例如套接字接口、传输层接口（Transport Layer Interface，TLI）以及 STREAM）
+ 套接字接口提供应用层和操作系统间通信的指令集，是一个可以被某进程用来与另一个进程通信的指令集。
+ 客户-服务器模式的通信是在套接字之间的，我们需要一对套接字地址（socket address）：一个本地套接字地址和一个远程套接字地址。套接字地址应该是一个 IP 地址（32位整数）和一个端口号（16位整数）的组合。
+ 服务器站点
  + 本地套接字地址：本地（服务器）套接字地址由操作系统提供。当服务器开始运行时，它就得知了本地套接字地址。
  + 远程套接字地址：对服务器来说，远程套接字地址是建立连接的客户套接字地址。服务器的本地套接字地址是固定的并且在生存期内一直使用，但是远程套接字地址在服务器与不同客户进行交互时都会改变（客户套接字地址包含在发送给服务器的请求报文中）。
+ 客户站点
  + 本地套接字地址：本地（客户）套接字地址也由操作系统提供。操作系统知道运行着客户进程的计算机的 IP 地址。然而端口号是每次客户进程需要开始通信时分配给客户进程的一个临时 16 位整数。
  + 远程套接字地址：有时，开启客户进程的用户知道运行着服务器进程的计算机的端口号和 IP 地址。有时候，用户知道一个唯一表示服务器进程的标识符（例 Uniform Resource Location， URL），客户进程需要通过域名系统（Domain Name System, DNS）获得 IP 地址，再通过熟知的端口号组装成远程套接字地址。
+ 传输层协议
  + UDP 协议：UDP 提供了无连接的、不可靠的数据报服务。无连接服务意味着两个交换报文的终端之间没有逻辑连接。每个报文都是独立的实体，它被封装在一个称为数据报（datagram）的分组中。UDP 看不到来自同一个源端并去往同一个目的地的数据报之间的关系（连接）。（类似于邮局的邮件，损坏和丢失是经常且没有办法的事情）
  + TCP 协议：TCP 提供面向连接的可靠的字节流传输。TCP 要求两个重点首先通过交换一些连接建立分组（connection-establishment packet）来建立一个逻辑连接。这个阶段有时称为握手，它设定了两个终端间的某些参数。这些参数包括要交换的数组分组大小、用于保存数据直到整个报文全部到达的缓冲区的大小等等。在握手过程后，两个终端可以向着彼此方向以报文段形式发送数据块。通过计算交换的字节数，可以检测字节的连续性。比如，某些字节丢失或损坏了，接收端可以请求重发这些字节，这使得 TCP 成为一个可靠协议。（类似于打电话，听不清可以让对方重说）
  + SCTP：SCTP 提供了前面两个协议组合的功能。就像 TCP 一样，SCTP 提供了面向连接的可靠的服务，但是它不是面向字节流。它是像 UDP 一样面向报文的。除此之外，SCTP 可以通过提供多媒体网络层连接提供多媒体流服务。

## 标准客户-服务器应用
+ HTTP和万维网
+ 文件传输和电子邮件应用
+ TELNET 和 SSH 协议（远程登录）
+ DNS

## 万维网
+ 万维网（WWW/Web）是分布式的（distributed）和链接的（linked）
  + 分布式：分布式允许 Web 增长。世界上每个 Web 服务器都可以增加一个新的网页到这个宝库中并向所有因特网用户宣告，而这不会使一些服务器超载。
  + 链接：链接使得一个网页与另一个存储在世界某个地方的主机上的网页相互引用。
+ 如今 WWW 是一个分布式客户-服务器服务。使得浏览器的用户可以访问一个正在服务器上运行的服务。然而服务是分布在很多称为站点（site）的地点上。每一个站点有一个或多个文档，它们称为网页。但是，每个网页（web page）可以包含一些到其他网页的链接，那些被链接的网页可以在同一个站点也可以在其他站点。
+ 网络客户（浏览器）通常包含三部分：控制程序、客户协议和解释程序。
  + 控制程序接收来自键盘和鼠标的输入并使用客户端程序来访问文档；
  + 客户协议可以是HTTP 或 FTP；
  + 在文档被访问后，控制程序使用解释程序来在屏幕上显示文档；（HTML、Java 或 Javascript）
+ 网络资源定位符（URL）包含了四个标识符：协议、主机、端口、路径。
+ 网上文档
  + 静态文档（Static Document）：静态文档是在服务器中创建和存储的固定内容的文档。文件的内容在创建时决定，而不是使用时决定。（Hypertext Markup Language, HTML、Extensible Markup Language, XML、Extensible Style Language, XSL）;
  + 动态文档（Dynamic Document）：当浏览器请求文档时动态文档就被网页服务器创建。由于对每个请求都要创建一个全新的文档，因此动态文档的内容随着请求的不同而不同。（CGI、JSP、ASP）
  + 活动文档（Active Document）：对很多应用来说，我们需要在客户站点运行一个程序或脚本，这些称为活动文档。（Javascript）

## 超文本传输协议（HTTP）
+ HTTP 是一种用来定义客户服务器程序如何编写和如何从万维网获取网页的协议。一个 HTTP 客户发送一个请求；HTTP 服务器返回响应。服务器使用80端口号；客户使用一个临时端口号。HTTP 使用 TCP 服务。
+ 非持续连接
  + 客户开启一个 TCP 连接并发送请求；
  + 服务器发送响应并关闭连接；
  + 客户读取数据直到它遇到了文件结束标记，然后关闭连接；
+ 非持续策略给服务器带来了高额开销，因为每次连接被开启时服务器都需要 N+1 个不同的缓冲区。
+ HTTP1.1 版默认指定了持续连接。在持续连接中服务器在发送一个相应后，为响应更多的请求而将连接置为打开状态。服务器可以在客户的请求下或者在超时情况下将连接关闭。发送方通常在每次响应中发送数据长度。
+ 请求报文
  + 请求的第一行被称为请求行，这一行有三部分由空格隔开并且被两个字符（回车和换行）终止。这些字段称为方法、URL 和版本。
+ 请求方法
  + GET：向服务器请求文档；
  + HEAD：请求关于文档的信息，而不是文档本身；
  + PUT：从客户端向服务器发送文档；
  + POST：从客户端向服务器发送一些信息；
  + TRACE：回送输入的请求；
  + DELETE：删除网页；
  + CONNECT：预留；
  + OPTIONS：询问有关可用的选项；