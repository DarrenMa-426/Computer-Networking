# TCP（Transfer Control Protocol） 抓包笔记

## 头部字段
- Source Port: 16bits
  - 源主机端口号，源主机端口号一般由客户端随机在一个范围内挑选一个空闲的端口号，不是固定的。
  - 这是一个 16 位的字段，它定义了在主机中发送该段的应用程序的端口号。
- Destination Port: 16bits
  - 目的主机端口号，这个端口号一般是在连接之前需要为客户端指定的一个固定端口号，这个端口号一般是固定的（服务器进程的端口号）。
  - 这是一个 16 位的字段，它定义了在主机中接收该段的应用程序的端口号。
- Sequence Number: 32bits
  - 序号（发送），表示的是这个段中的第一个字节的序号。如果 SYN 字段已经存在的话，则序号就是 SYN 的初始值加一；
  - 用来表示从 TCP 发送端和向 TCP 接收端发送的数据字节流，它表示在这个报文段中的第一个数据字节在数据流中的序号；主要用来解决网络报乱序的问题；
- Acknowledgment Number: 32bits
  - 序号（确认），如果设置了 ACK 标志位，这个字段所包含的值表示下一次期望收到的字节流序号，建立连接后该字段将会始终被发送；
  - 32 位确认序列号包含发送确认的一段所期望收到的下一个序号，因此，确认序号应当是上次已成功收到的数据字节序号加 1。不过，之后当标志位中的 ACK 表示为 1 时，该确认序列号的字段才有效，主要用来解决不丢包的问题。
- Data Offset: 4bits
  - 数据偏移字段，表示首部字段偏移多少个字节才是内容，4 bits 可以表示 15 个数字，每个数字表示 4 个字节，总共可以表示 4 * 15 = 60 byte，因此 TCP 最多有 60 字节的首部。
- TCP Flags：6 bits
  - TCP 首部中有 6 个标志比特，它们中的多个可同时被设置为 1，主要是用于操控 TCP 的状态机的
    - URG：此标志表示 TCP 包的紧急指针域有效，用来保证 TCP 连接不被终端，并且督促中间层要尽快处理这些数据；
    - ACK：此标志表示应答域（Acknowledgment Number）有效，告知发送端数据接收成功并将 Acknowledgment Number 的值设置为下一次期望收到的字节流序号；
    - PSH：这个标志位表示 Push 操作。所谓 Push 操作就是指在数据包到达接收端以后，立即传送给应用程序，而不是在缓冲区中排队；
    - RST：这个标志位表示连接复位请求。用来复位那些产生错误的链接，也被用来拒绝错误和非法的数据报；
    - SYN：表示同步序号，用来建立连接；也用于差错控制；
    - FIN：表示发送端已经到达数据末尾，也就是说双方的数据传送完成，没有数据可以传送了，发送 FIN 标志位的 TCP 数据包后，连接将被断开。
- Window: 16 bits
  - 窗口大小：在 TCP 报文段首部中，”窗口大小“字段通常用于告知对方自己的能够接受的数据量大小。窗口本质就是一个缓冲区 Buffer，该字段的值用于告知对方自己剩余的可用缓冲区大小。在每一个 TCP 报文段中都会通过”窗口“字段告知对方自己的所能接受数据的大小。窗口大小通常用滑动窗口流量控制。
  - MSS：MSS 是报文中 TCP 段中数据部分的最大长度，如果上层交付下来的数据超过 MSS 就要对交付下来的数据进行分段。在 TCP 连接的第一次、第二次握手中会分别告知对方 MSS，从而起到通信双方协商 MSS 的结果。