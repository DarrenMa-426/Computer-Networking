# 传输控制协议
传输控制协议（Transfer Control Protocol，TCP）是一个面向连接可靠的协议。TCP 显式定义了连接建立、数据传输以及连接拆除阶段来提供面向连接服务。TCP 使用 GBN 和 SR 协议的组合来提供可靠性。为了实现这个目的，TCP 使用校验和（为差错发现）、丢失或被破坏分组重传、累积和选择确认以及计时器。

## 流传递服务
+ TCP 允许发送进程以字节流形式传递数据，并且接收进程也以字节流形式接收数据。TCP 建立一种环境，在这种环境中，两个进程好像由一个假想的”管道“连接，这个管道通过因特网传送这些进程的数据。
+ 发送和接收缓冲区
  + 因为发送和接收进程可能以不同的速度写入和读出数据，所以 TCP 需要用于存储的缓冲区。
  + 每个方向都存在一个缓冲区：发送缓冲区和接收缓冲区。
  + 这些缓冲区也用于 TCP 流量和差错控制机制。
  + 发送缓冲区：灰色存储单元的字节被确认后，这些存储单元可以回收并且对发送进程可用。
  + 回收缓冲区：当某个字节被接收进程独处以后，这个存储单元可被回收，并加入到空存储单元池中。
+ IP 层作为 TCP 服务的提供者，需要以分组的方式而不是字节流的方式发送数据。在传输层，TCP 将多个字节组合在一起成为一个分组，这个分组称为段（segment）。
+ TCP 提供全双工服务，即数据可以在同一时间双向流动。每一方向 TCP 都有发送和接收缓冲区，它们能在双向发送和接收段。
+ 逻辑连接
  + 在两个 TCP 之间建立一个连接；
  + 在两个方向交换数据；
  + 连接终止；
+ TCP 是一种可靠的传输协议。它使用确认机制来检查数据是否安全和完整的到达。

## TCP 的特点
+ TCP 在段的头部采用称为序号（sequence number）和确认号（acknowledgment number）的两个字段。这两个字段指的是字节序号，而不是段序号
+ 字节序号
  + TCP 为在一个连接中传输的所有数据字节（八位字节）编号。在每个方向上序号都是独立的。
  + 当 TCP 接收来自进程（应用层）的一些数据字节时，TCP 将它们存储在发送缓冲区中并给它们编号。
  + TCP 在 0 到 2 的 32 次方 - 1 之间生成一个随机数作为第一个字节的序号。（例如，如果随机数是 1057，而且发送的全部字节个数是 6000，那么这些字节序号是 1057~7056。
  + 在每个连接中传送的字节都由 TCP 编号，序号开始于一个随机产生的数。
+ （段）序号
  + 第一段的序号是初始序号（initial sequence number，ISN），这是一个随机数。
  + 其他段的序号是之前段的序号加之前段携带的字节数（实际上的或想象的）。之后，我们将给出一些控制端，它们被认为携带了一个想象字节。
  + 一个段的序号字段的值定义了该段包含的第一个字节的序号。
+ 确认号
  + 确认号定义了该方预期接收的下一个字节的序号。
  + 术语“累积”指的是，如果一方使用 5643 作为确认号，则表示它已经接收了所有从开始到序号为 5642 的字节。
  + 段中确认字段的值定义了通信一方预期接收的下一个字节的编号。确认号是累积的。