# 介绍
TCP/IP 协议簇中的传输层位于应用层和网络层之间。它为应用层提供服务，并接收来自网络层的服务。传输层是客户程序和服务器程序之间的联络人，是一个进程到进程的连接。传输层是 TCP/IP 协议簇的核心；它是因特网上从一个点到另一个点传输数据的端到端逻辑传输媒介。

## 传输层服务
+ 传输层协议的首要任务是提供进程到进程通信（process-to-process communication）。进程是使用传输层服务的应用层实体（运行着的程序）。
+ 网络层负责计算机层次的通信（主机到主机通信）；传输层协议负责将报文传输到正确的进程（进程到进程通信）。

## 寻址：端口号
+ 对通信来说，我们必须定义本地主机、本地进程、远程主机和远程进程。我们使用 IP 地址来定义本地主机和远程主机。我们使用端口号来定义本地进程和远程进程，端口号是 0 到 65535 之间的 16 位整数。
+ 客户程序用端口号定义它主机，这称为临时端口号，因为客户的生命周期通常很短。
+ 目的 IP 地址在世界范围的不同主机中确定一个主机。但主机被选定后，端口号定义了在该特定主机上的多个进程中的一个进程。
+ ICANN 范围
  + 熟知端口：端口号的范围是 0~1023，由 ICANN 分配和控制。（例如 http:80 ftp:21 ssh:22 telnet:23）
  + 注册端口：端口号的范围是 1024~49151，ICANN 不分配也不控制。它们可在 ICANN 注册以防重复。
  + 动态端口：端口号的范围是 49151~65535，这一范围内的端口号既不受控制又不需要注册，可以由任何进程使用。它们是临时或私有端口号。
+ 套接字地址：在 TCP 协议簇的传输层协议需要 IP 地址和端口号，它们各在一段建立一条连接。一个 IP 地址和一个端口号结合起来成为套接字地址（socket address）。
+ 封装与解封装：为了将报文从一个进程发送到另一进程，传输层协议负责封装和解封装报文。
+ 多路复用与多路分解：每当一个实体从一个以上的源接收数据时，成为多路复用（多对一）；每当一个实体将数据项传递到一个以上的源时，成为多路分解（一对多）；
+ 流量控制：
  + 推或拉：每当发送方生产数据项时，它无须事前获得消费者的请求就会发送它们——这种传递称为推。如果生产者在消费者请求这些数据项之后进行发送，这种传递称为拉。
  + 传输层流量控制：在传输层通信中，我们需要处理四个实体：发送方进程、发送方传输层、接收方传输层、接收方进程。我们最少需要两种流量控制：从发送方传输层到发送方应用层的流量控制、从接收方传输层到发送方传输层的流量控制。
  + 缓冲区：流量控制通常使用两个缓冲区来进行控制：一个位于发送方传输层、另一个位于接收方传输层。缓冲区是一组内存单元，它可以在发送端和接收端存储分组。消费者向发送者发送信号从而进行流量控制通信。

## 差错控制
+ 传输层的差错控制负责以下几个方面：
  + 发现并丢弃被破坏的分组；
  + 记录丢失和丢弃的分组并重传它们；
  + 识别重复分组并放弃它们；
  + 缓冲失序分组直到丢失的分组到达；
+ 序号：差错控制需要发送方传输层直到哪个分组要被重传并且接收方传输层需要知道哪个分组是重复的、哪个分组是失序的。我们可以在传输层分组中加入一个字段来保存分组的序号。 当分组被破坏或丢失，接收方传输层可按某种方式通知发送方传输层去利用序号重传分组。
+ 对于差错控制，序号是模 2 的 m 次方，m 是序号字段的大小，单位是比特。
+ 接收方可以为每一组正确到达的分组发送一个确认（ACK）。接收方可以简单地丢弃被破坏的分组。发送方如果使用计时器，它就可以发现丢失分组。当一个分组被发送，发送方就开启一个计时器。如果 ACK 在计时器超时之前没有到达，那么发送方重发这个分组。重复的分组可以被接收方默默丢弃。
+ 如果我们使用两个带序号的缓冲区：一个位于发送端，一个位于接收端，那么流量控制和差错控制就可以组合在一起。

## 拥塞控制
+ 如果网络中的负载（load，即发送到网络的分组数）大于网络的容量（网络可以处理的分组数），那么网络就可能发生拥塞。拥塞控制（congestion control）指的是一种机制和技术，它控制拥塞并将负载保持在容量以内。

## 无连接服务和面向连接服务
+ 无连接服务
  + 在无连接服务中，源进程（应用程序）需要将报文分成传输层可接受大小的数据块，并将它们一个一个地传递到传输层。传输层将每一个数据块看做彼此没有关系的单元。
  + 由于双方传输层没有互相协调，所以流量控制、差错控制和拥塞控制都不能在无连接服务中有效实现。
+ 面向连接服务
  + 在面向连接的服务中，首先需要建立客户与服务器之间的逻辑连接，只有连接建立之后才能进行数据交换。在数据交换之后，连接需要拆除。